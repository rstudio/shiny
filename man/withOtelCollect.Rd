% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/otel-with.R
\name{withOtelCollect}
\alias{withOtelCollect}
\alias{localOtelCollect}
\title{Temporarily set OpenTelemetry collection level}
\usage{
withOtelCollect(collect, expr)

localOtelCollect(collect, envir = parent.frame())
}
\arguments{
\item{collect}{Character string specifying the OpenTelemetry collection level.
Must be one of \code{"none"}, \code{"reactivity"}, or \code{"all"}.}

\item{expr}{Expression to evaluate with the specified collection level
(for \code{withOtelCollect()}).}

\item{envir}{Environment where the collection level should be set
(for \code{localOtelCollect()}). Defaults to the parent frame.}
}
\value{
\itemize{
\item \code{withOtelCollect()} returns the value of \code{expr}.
\item \code{localOtelCollect()} is called for its side effect and returns the previous
\code{collect} value invisibly.
}
}
\description{
\code{withOtelCollect()} temporarily sets the OpenTelemetry collection level for
the duration of evaluating \code{expr}. \code{localOtelCollect()} sets the collection
level for the remainder of the current function scope.

These functions are useful for temporarily controlling telemetry collection
during reactive expression creation. Only the following levels are allowed:
\itemize{
\item \code{"none"} - No telemetry data collected
\item \code{"reactivity"} - Collect reactive execution spans (includes session and
reactive update events)
\item \code{"all"} - All available telemetry (currently equivalent to \code{"reactivity"})
}

Note that \code{"session"} and \code{"reactive_update"} levels are not permitted as
these are runtime-specific levels that should only be set permanently via
\code{options(shiny.otel.collect = ...)} or the \code{SHINY_OTEL_COLLECT} environment
variable, not temporarily during reactive expression creation.
}
\section{Intended Usage}{


These functions are designed to perform sweeping changes to telemetry
collection, such as enabling or disabling OpenTelemetry for an entire module
or section of code where reactive expressions are being \strong{created}:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{# Enable telemetry for an entire module
withOtelCollect("all", \{
  my_result <- my_module("my_id")
\})

# Disable telemetry for expensive development-only reactives
withOtelCollect("none", \{
  debug_reactive <- reactive(\{ expensive_debug_computation() \})
\})
}\if{html}{\out{</div>}}
}

\section{Pipe Usage (Not Recommended)}{


While these functions technically work with pipes, this usage is \strong{not
recommended} because the reactive expression has already been created by the
time the pipe executes, so the telemetry settings have no effect:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{# Technically works, but not recommended
x <- reactive(\{ ... \}) \%>\% withOtelCollect(collect = "all")
x <- reactive(\{ ... \}) |> withOtelCollect(collect = "all")
# Equivalent to:
x <- withOtelCollect("all", reactive(\{ ... \}))

# Does NOT work as intended
x <- reactive(\{ ... \})
# `x` was created outside of `withOtelCollect()`, so OTel settings are not applied
x_no_otel <- withOtelCollect("all", x)

# Best practice is to create the reactive object inside the withOtelCollect() call
withOtelCollect("all", \{
  x_with_otel <- reactive(\{ ... \})
  y_with_otel <- reactive(\{ ... \})
\})
}\if{html}{\out{</div>}}

The correct approach is to create the reactive expression \strong{inside} the
\code{withOtelCollect()} call or \strong{after} setting the local collection level with
\code{localOtelCollect()}.
}

\examples{
\dontrun{
# Temporarily disable telemetry collection
withOtelCollect("none", {
  # Code here won't generate telemetry
  reactive({ input$x + 1 })
})

# Collect reactivity telemetry but not other events
withOtelCollect("reactivity", {
  # Reactive execution will be traced
  observe({ print(input$x) })
})

# Use local variant in a function
my_function <- function() {
  localOtelCollect("none")
  # Rest of function executes without telemetry
  reactive({ input$y * 2 })
}
}

}
\seealso{
See the \code{shiny.otel.collect} option within \code{\link{shinyOptions}}. Setting
this value will globally control OpenTelemetry collection levels.
}
