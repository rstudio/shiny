% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/otel-with.R
\name{withOtelCollect}
\alias{withOtelCollect}
\alias{localOtelCollect}
\title{Temporarily set OpenTelemetry collection level}
\usage{
withOtelCollect(collect, expr)

localOtelCollect(collect, envir = parent.frame())
}
\arguments{
\item{collect}{Character string specifying the OpenTelemetry collection level.
Must be one of \code{"none"}, \code{"reactivity"}, or \code{"all"}.}

\item{expr}{Expression to evaluate with the specified collection level
(for \code{withOtelCollect()}).}

\item{envir}{Environment where the collection level should be set
(for \code{localOtelCollect()}). Defaults to the parent frame.}
}
\value{
\itemize{
\item \code{withOtelCollect()} returns the value of \code{expr}.
\item \code{localOtelCollect()} is called for its side effect and returns the previous
\code{collect} value invisibly.
}
}
\description{
\code{withOtelCollect()} temporarily sets the OpenTelemetry collection level for
the duration of evaluating \code{expr}. \code{localOtelCollect()} sets the collection
level for the remainder of the current function scope.

These functions are useful for temporarily controlling telemetry collection
during reactive expression creation. Only the following levels are allowed:
\itemize{
\item \code{"none"} - No telemetry data collected
\item \code{"reactivity"} - Collect reactive execution spans (includes session and
reactive update events)
\item \code{"all"} - All available telemetry (currently equivalent to \code{"reactivity"})
}

Note that \code{"session"} and \code{"reactive_update"} levels are not permitted as
these are runtime-specific levels that should only be set permanently via
\code{options(shiny.otel.collect = ...)} or the \code{SHINY_OTEL_COLLECT} environment
variable, not temporarily during reactive expression creation.
}
\section{Intended Usage}{


These functions are designed to perform sweeping changes to telemetry
collection, such as enabling or disabling OpenTelemetry for an entire module
or section of code where reactive expressions are being \strong{created}:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{# Enable telemetry for an entire module
withOtelCollect("all", \{
  my_result <- my_module("my_id")
\})

# Disable telemetry for expensive development-only reactives
withOtelCollect("none", \{
  debug_reactive <- reactive(\{ expensive_debug_computation() \})
\})
}\if{html}{\out{</div>}}
}

\section{Pipe Usage (Not Recommended)}{


While using \code{withOtelCollect()} as a pipe-able method, it is not recommended due to the use case where the reactive object is created before the \code{withOtelCollect()} call. In such cases, the reactive object will not inherit the intended OpenTelemetry settings.

Therefore, to avoid this hard-to-debug situation, we recommend that you only create your reactive objects within the \code{withOtelCollect()} call or after setting the local collection level with \code{localOtelCollect()}.

\if{html}{\out{<div class="sourceCode r">}}\preformatted{# Technically works, but not recommended
x <- reactive(\{ ... \}) \%>\% withOtelCollect(collect = "all")
x <- reactive(\{ ... \}) |> withOtelCollect(collect = "all")
# Equivalent to:
x <- withOtelCollect("all", reactive(\{ ... \}))

# Does NOT work as intended
x <- reactive(\{ ... \})
# `x` was created outside of `withOtelCollect()`,
# therefore no OTel settings are applied
x_no_otel <- withOtelCollect("all", x)

# Best practice: Create the reactive object within `expr=`
withOtelCollect("all", \{
  x_with_otel <- reactive(\{ ... \})
  y_with_otel <- reactive(\{ ... \})
\})
}\if{html}{\out{</div>}}
}

\examples{
\dontrun{
# Temporarily disable telemetry collection
withOtelCollect("none", {
  # Code here won't generate telemetry
  reactive({ input$x + 1 })
})

# Collect reactivity telemetry but not other events
withOtelCollect("reactivity", {
  # Reactive execution will be traced
  observe({ print(input$x) })
})

# Use local variant in a function
my_function <- function() {
  localOtelCollect("none")
  # Rest of function executes without telemetry
  reactive({ input$y * 2 })
}
}

}
\seealso{
See the \code{shiny.otel.collect} option within \code{\link{shinyOptions}}. Setting
this value will globally control OpenTelemetry collection levels.
}
