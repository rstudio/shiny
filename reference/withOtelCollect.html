<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Temporarily set OpenTelemetry collection level — withOtelCollect • shiny</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Temporarily set OpenTelemetry collection level — withOtelCollect"><meta property="og:description" content='withOtelCollect() temporarily sets the OpenTelemetry collection level for
the duration of evaluating expr. localOtelCollect() sets the collection
level for the remainder of the current function scope.
These functions are useful for temporarily controlling telemetry collection
during reactive expression creation. Only the following levels are allowed:
"none" - No telemetry data collected
"reactivity" - Collect reactive execution spans (includes session and
reactive update events)
"all" - All available telemetry (currently equivalent to "reactivity")


Note that "session" and "reactive_update" levels are not permitted as
these are runtime-specific levels that should only be set permanently via
options(shiny.otel.collect = ...) or the SHINY_OTEL_COLLECT environment
variable, not temporarily during reactive expression creation.'><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">shiny</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.12.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rstudio/shiny/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Temporarily set OpenTelemetry collection level</h1>
    <small class="dont-index">Source: <a href="https://github.com/rstudio/shiny/blob/main/R/otel-with.R" class="external-link"><code>R/otel-with.R</code></a></small>
    <div class="hidden name"><code>withOtelCollect.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>withOtelCollect()</code> temporarily sets the OpenTelemetry collection level for
the duration of evaluating <code>expr</code>. <code>localOtelCollect()</code> sets the collection
level for the remainder of the current function scope.</p>
<p>These functions are useful for temporarily controlling telemetry collection
during reactive expression creation. Only the following levels are allowed:</p><ul><li><p><code>"none"</code> - No telemetry data collected</p></li>
<li><p><code>"reactivity"</code> - Collect reactive execution spans (includes session and
reactive update events)</p></li>
<li><p><code>"all"</code> - All available telemetry (currently equivalent to <code>"reactivity"</code>)</p></li>
</ul><p>Note that <code>"session"</code> and <code>"reactive_update"</code> levels are not permitted as
these are runtime-specific levels that should only be set permanently via
<code>options(shiny.otel.collect = ...)</code> or the <code>SHINY_OTEL_COLLECT</code> environment
variable, not temporarily during reactive expression creation.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">withOtelCollect</span><span class="op">(</span><span class="va">collect</span>, <span class="va">expr</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">localOtelCollect</span><span class="op">(</span><span class="va">collect</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-collect">collect<a class="anchor" aria-label="anchor" href="#arg-collect"></a></dt>
<dd><p>Character string specifying the OpenTelemetry collection level.
Must be one of <code>"none"</code>, <code>"reactivity"</code>, or <code>"all"</code>.</p></dd>


<dt id="arg-expr">expr<a class="anchor" aria-label="anchor" href="#arg-expr"></a></dt>
<dd><p>Expression to evaluate with the specified collection level
(for <code>withOtelCollect()</code>).</p></dd>


<dt id="arg-envir">envir<a class="anchor" aria-label="anchor" href="#arg-envir"></a></dt>
<dd><p>Environment where the collection level should be set
(for <code>localOtelCollect()</code>). Defaults to the parent frame.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>

<ul><li><p><code>withOtelCollect()</code> returns the value of <code>expr</code>.</p></li>
<li><p><code>localOtelCollect()</code> is called for its side effect and returns the previous
<code>collect</code> value invisibly.</p></li>
</ul></div>
    <div id="intended-usage">
    <h2>Intended Usage</h2>



<p>These functions are designed to perform sweeping changes to telemetry
collection, such as enabling or disabling OpenTelemetry for an entire module
or section of code where reactive expressions are being <strong>created</strong>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># Enable telemetry for an entire module</span></span>
<span><span class="fu"><a href="../reference/withOtelCollect.html">withOtelCollect</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="op">{</span></span>
<span>  <span class="va">my_result</span> <span class="op">&lt;-</span> <span class="fu">my_module</span><span class="op">(</span><span class="st">"my_id"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Disable telemetry for expensive development-only reactives</span></span>
<span><span class="fu"><a href="../reference/withOtelCollect.html">withOtelCollect</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="op">{</span></span>
<span>  <span class="va">debug_reactive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu">expensive_debug_computation</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div>
    </div>
    <div id="pipe-usage-not-recommended-">
    <h2>Pipe Usage (Not Recommended)</h2>



<p>While using <code>withOtelCollect()</code> as a pipe-able method, it is not recommended due to the use case where the reactive object is created before the <code>withOtelCollect()</code> call. In such cases, the reactive object will not inherit the intended OpenTelemetry settings.</p>
<p>Therefore, to avoid this hard-to-debug situation, we recommend that you only create your reactive objects within the <code>withOtelCollect()</code> call or after setting the local collection level with <code>localOtelCollect()</code>.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># Technically works, but not recommended</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="va">...</span> <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/withOtelCollect.html">withOtelCollect</a></span><span class="op">(</span>collect <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="va">...</span> <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/withOtelCollect.html">withOtelCollect</a></span><span class="op">(</span>collect <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span><span class="co"># Equivalent to:</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/withOtelCollect.html">withOtelCollect</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="fu"><a href="../reference/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="va">...</span> <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Does NOT work as intended</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="va">...</span> <span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># `x` was created outside of `withOtelCollect()`,</span></span>
<span><span class="co"># therefore no OTel settings are applied</span></span>
<span><span class="va">x_no_otel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/withOtelCollect.html">withOtelCollect</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Best practice: Create the reactive object within `expr=`</span></span>
<span><span class="fu"><a href="../reference/withOtelCollect.html">withOtelCollect</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="op">{</span></span>
<span>  <span class="va">x_with_otel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="va">...</span> <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">y_with_otel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="va">...</span> <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>See the <code>shiny.otel.collect</code> option within <code><a href="shinyOptions.html">shinyOptions</a></code>. Setting
this value will globally control OpenTelemetry collection levels.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Temporarily disable telemetry collection</span></span></span>
<span class="r-in"><span><span class="fu">withOtelCollect</span><span class="op">(</span><span class="st">"none"</span>, <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># Code here won't generate telemetry</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="va">input</span><span class="op">$</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Collect reactivity telemetry but not other events</span></span></span>
<span class="r-in"><span><span class="fu">withOtelCollect</span><span class="op">(</span><span class="st">"reactivity"</span>, <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># Reactive execution will be traced</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="observe.html">observe</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use local variant in a function</span></span></span>
<span class="r-in"><span><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">localOtelCollect</span><span class="op">(</span><span class="st">"none"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Rest of function executes without telemetry</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="reactive.html">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="va">input</span><span class="op">$</span><span class="va">y</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Winston Chang, Joe Cheng, JJ Allaire, Carson Sievert, Barret Schloerke, Garrick Aden-Buie, Yihui Xie, Jeff Allen, Jonathan McPherson, Alan Dipert, Barbara Borges, Posit Software, PBC.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

